#/bin/bash
#
# Modify UIDs for CIS 90 users so different than practice test
#
# usage:  tweak-uids (P1|T1)
#
# The cis90 user normally is 1200 and is fist CIS 90 student
#   - Practice test: add 611 to each UID (cis90 user becomes 1811)
#   - Real test: add 1425 to each user UID (cis90 user becomes 2625)

test=$1

if [ "$test" = "" ]; then
  echo "Usage: tweak-uids (P1|T1)"
  exit
elif [ "$test" = "P1" ]; then
  bump=611
elif [ "$test" = "T1" ]; then
  bump=1425
else
  echo "Usage: tweak-uids (P1|T1)"
  exit
fi

echo Current UIDs
gid=$(grep "cis90:" /etc/group | cut -f3 -d":")
for i in $(cat /etc/passwd | grep "$gid" | cut -f1 -d":"); do
  echo "$i is $(id -u $i)"
done

# If previously bumped, don't bump again
if [ "$(id -u cis90)" != "1200" ]; then
  echo UIDs were already bumped!
  echo Aborting script
  exit
fi

#confirm before proceeding
read -p "Press Enter to continue or Ctrl-C to abort ..."

# bump uids
gid=$(grep "cis90:" /etc/group | cut -f3 -d":")
for i in $(cat /etc/passwd | grep "$gid" | cut -f1 -d":"); do
  uid=$(id -u $i)
  let bumpedUid=$uid+$bump
  usermod -u $bumpedUid $i
  echo "$i is $(id -u $i)"
done

exit

